<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SudoSecure - Gestionnaire de mots de passe sécurisé</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- CSS personnalisé -->
    <link href="static/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary" id="mainNav" style="display: none;">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="bi bi-shield-lock"></i> SudoSecure</a>
            
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3" id="userInfo">Bienvenue, <span id="username"></span></span>
                <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> Déconnexion
                </button>
            </div>
        </div>
    </nav>

    <!-- Conteneur principal -->
    <div class="container-fluid">
        
        <!-- Page de connexion -->
        <div id="loginPage" class="row justify-content-center min-vh-100 align-items-center">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <h1 class="display-6"><i class="bi bi-shield-lock text-primary"></i></h1>
                            <h2 class="card-title">SudoSecure</h2>
                            <p class="text-muted">Gestionnaire de mots de passe sécurisé</p>
                        </div>
                        
                        <!-- Formulaire de connexion -->
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="loginUsername" class="form-label">Nom d'utilisateur</label>
                                <input type="text" class="form-control" id="loginUsername" required>
                            </div>
                            <div class="mb-3">
                                <label for="loginPassword" class="form-label">Mot de passe</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="loginPassword" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleLoginPassword">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mb-3" id="totpSection" style="display: none;">
                                <label for="totpCode" class="form-label">Code 2FA</label>
                                <input type="text" class="form-control" id="totpCode" maxlength="6" placeholder="123456">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100 mb-3">
                                <i class="bi bi-box-arrow-in-right"></i> Se connecter
                            </button>
                        </form>
                        
                        <div class="text-center">
                            <p class="mb-0">Pas encore de compte ?</p>
                            <button class="btn btn-link" id="showRegister">Créer un compte</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page d'inscription -->
        <div id="registerPage" class="row justify-content-center min-vh-100 align-items-center" style="display: none;">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <h1 class="display-6"><i class="bi bi-person-plus text-primary"></i></h1>
                            <h2 class="card-title">Créer un compte</h2>
                        </div>
                        
                        <form id="registerForm">
                            <div class="mb-3">
                                <label for="registerEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="registerEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="registerUsername" class="form-label">Nom d'utilisateur</label>
                                <input type="text" class="form-control" id="registerUsername" required>
                            </div>
                            <div class="mb-3">
                                <label for="registerPassword" class="form-label">Mot de passe</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="registerPassword" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleRegisterPassword">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div id="passwordCriteriaContainer" class="form-text">
                                    Au moins 12 caractères avec majuscules, minuscules, chiffres et symboles
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100 mb-3">
                                <i class="bi bi-person-plus"></i> Créer le compte
                            </button>
                        </form>
                        
                        <div class="text-center">
                            <p class="mb-0">Déjà un compte ?</p>
                            <button class="btn btn-link" id="showLogin">Se connecter</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard principal -->
        <div id="dashboard" style="display: none;">
            <div class="row mt-4">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-list"></i> Menu</h5>
                            <div class="list-group list-group-flush">
                                <a href="#" class="list-group-item list-group-item-action active" id="credentialsTab">
                                    <i class="bi bi-key"></i> Mes identifiants
                                </a>
                                <a href="#" class="list-group-item list-group-item-action" id="generatorTab">
                                    <i class="bi bi-gear"></i> Générateur
                                </a>
                                <a href="#" class="list-group-item list-group-item-action" id="securityTab">
                                    <i class="bi bi-shield-check"></i> Sécurité
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenu principal -->
                <div class="col-md-9">
                    
                    <!-- Section des identifiants -->
                    <div id="credentialsSection">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3><i class="bi bi-key"></i> Mes identifiants</h3>
                            <button class="btn btn-primary" id="addCredentialBtn">
                                <i class="bi bi-plus"></i> Ajouter
                            </button>
                        </div>
                        
                        <!-- Barre de recherche -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control" id="searchInput" placeholder="Rechercher par titre ou nom d'utilisateur...">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Liste des identifiants -->
                        <div id="credentialsList">
                            <div class="text-center py-5">
                                <i class="bi bi-key display-4 text-muted"></i>
                                <p class="text-muted">Aucun identifiant trouvé</p>
                            </div>
                        </div>
                        
                        <!-- Pagination -->
                        <nav id="pagination" style="display: none;">
                            <ul class="pagination justify-content-center" id="paginationList">
                            </ul>
                        </nav>
                    </div>

                    <!-- Section générateur de mot de passe -->
                    <div id="generatorSection" style="display: none;">
                        <h3><i class="bi bi-gear"></i> Générateur de mots de passe</h3>
                        
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="passwordLength" class="form-label">Longueur: <span id="lengthValue">16</span></label>
                                            <input type="range" class="form-range" id="passwordLength" min="4" max="64" value="16">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="includeUppercase" checked>
                                                <label class="form-check-label" for="includeUppercase">Majuscules (A-Z)</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="includeLowercase" checked>
                                                <label class="form-check-label" for="includeLowercase">Minuscules (a-z)</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="includeNumbers" checked>
                                                <label class="form-check-label" for="includeNumbers">Chiffres (0-9)</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="includeSymbols" checked>
                                                <label class="form-check-label" for="includeSymbols">Symboles (!@#$...)</label>
                                            </div>
                                        </div>
                                        
                                        <button class="btn btn-primary" id="generatePasswordBtn">
                                            <i class="bi bi-arrow-clockwise"></i> Générer
                                        </button>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="generatedPassword" class="form-label">Mot de passe généré</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control font-monospace" id="generatedPassword" readonly>
                                                <button class="btn btn-outline-secondary" type="button" id="copyPasswordBtn">
                                                    <i class="bi bi-clipboard"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Force du mot de passe</label>
                                            <div class="progress">
                                                <div class="progress-bar" id="strengthBar" role="progressbar" style="width: 0%"></div>
                                            </div>
                                            <small class="text-muted" id="strengthText">-</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section sécurité -->
                    <div id="securitySection" style="display: none;">
                        <h3><i class="bi bi-shield-check"></i> Paramètres de sécurité</h3>
                        
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Authentification à deux facteurs (2FA)</h5>
                                <p class="card-text">Ajoutez une couche de sécurité supplémentaire à votre compte.</p>
                                
                                <div id="2faDisabled">
                                    <button class="btn btn-success" id="enable2faBtn">
                                        <i class="bi bi-shield-check"></i> Activer la 2FA
                                    </button>
                                </div>
                                
                                <div id="2faEnabled" style="display: none;">
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle"></i> La 2FA est activée sur votre compte
                                    </div>
                                    <button class="btn btn-danger" id="disable2faBtn">
                                        <i class="bi bi-shield-x"></i> Désactiver la 2FA
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Modal pour ajouter/modifier un identifiant -->
    <div class="modal fade" id="credentialModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="credentialModalTitle">Ajouter un identifiant</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="credentialForm">
                        <input type="hidden" id="credentialId">
                        
                        <div class="mb-3">
                            <label for="credentialTitle" class="form-label">Titre *</label>
                            <input type="text" class="form-control" id="credentialTitle" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="credentialUrl" class="form-label">URL du site</label>
                            <input type="url" class="form-control" id="credentialUrl">
                        </div>
                        
                        <div class="mb-3">
                            <label for="credentialUsername" class="form-label">Nom d'utilisateur</label>
                            <input type="text" class="form-control" id="credentialUsername">
                        </div>
                        
                        <div class="mb-3">
                            <label for="credentialPassword" class="form-label">Mot de passe *</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="credentialPassword" required>
                                <button class="btn btn-outline-secondary" type="button" id="toggleCredentialPassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-outline-primary" type="button" id="generateForCredential">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="credentialNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="credentialNotes" rows="3"></textarea>
                        </div>
                        
                        
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" id="saveCredentialBtn">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour afficher un mot de passe -->
    <div class="modal fade" id="revealPasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mot de passe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="revealedPassword">
                        <div class="mb-3">
                            <label class="form-label">Mot de passe</label>
                            <div class="input-group">
                                <input type="text" class="form-control font-monospace" id="revealedPasswordText" readonly>
                                <button class="btn btn-outline-secondary" type="button" id="copyRevealedPassword">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </div>
                        <div id="passwordTimer" class="text-center mt-3" style="display: none;">
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-warning" role="progressbar" id="timerProgressBar" style="width: 100%"></div>
                            </div>
                            <small class="text-muted">Le mot de passe sera masqué dans <span id="timerSeconds">10</span> secondes</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour configurer la 2FA -->
    <div class="modal fade" id="setup2faModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Configurer la 2FA</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="qrCodeStep">
                        <p>Scannez ce QR code avec votre application d'authentification :</p>
                        <div class="text-center mb-3">
                            <img id="qrCodeImage" class="img-fluid" alt="QR Code">
                        </div>
                        <p>Ou entrez manuellement cette clé secrète :</p>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control font-monospace" id="secretKey" readonly>
                            <button class="btn btn-outline-secondary" type="button" id="copySecretKey">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                        
                        <div class="alert alert-warning">
                            <strong>Codes de récupération :</strong>
                            <div id="backupCodes" class="font-monospace small"></div>
                            <button class="btn btn-sm btn-outline-primary" id="copyBackupCodes">
                                <i class="bi bi-clipboard"></i> Copier les codes
                            </button>
                        </div>
                    </div>
                    
                    <div id="verifyStep">
                        <form id="verify2faForm">
                            <div class="mb-3">
                                <label for="verify2faCode" class="form-label">Code de vérification</label>
                                <input type="text" class="form-control" id="verify2faCode" maxlength="6" required>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" id="verify2faBtn">Vérifier et activer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast container pour les notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer">
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/js/app.js"></script>
</body>
</html>